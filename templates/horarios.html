<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Hor√°rios</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body class="fundo-logo">

<div class="card">
    <h1>‚è∞ Hor√°rios</h1>

    {% for h in horarios %}
        {% set tipo = tipos_horarios.get(h) %}

        <div class="linha-horario">

            <!-- ================= CLIENTE ================= -->
            {% if tipo_usuario != "dono" %}

                {% if h in ocupados %}
                    <button class="btn bloqueado" disabled>{{ h }} (Ocupado)</button>

                {% elif tipo == "fechada" %}
                    <button class="btn bloqueado" disabled>{{ h }} (Arena fechada)</button>

                {% elif tipo == "fixo" %}
                    <button class="btn bloqueado" disabled>{{ h }} (Hor√°rio fixo)</button>

                {% elif tipo == "dayuse" %}
                    <button class="btn bloqueado" disabled>{{ h }} (Day Use)</button>

                {% else %}
                    <form method="POST" action="/reservar">
                        <input type="hidden" name="esporte" value="{{ esporte }}">
                        <input type="hidden" name="quadra" value="{{ quadra }}">
                        <input type="hidden" name="data" value="{{ data }}">
                        <input type="hidden" name="horario" value="{{ h }}">
                        <button type="submit" class="btn">{{ h }}</button>
                    </form>
                {% endif %}

            {% endif %}

            <!-- ================= DONO ================= -->
            {% if tipo_usuario == "dono" %}
                <span class="horario-texto">{{ h }}</span>

                <select
                    onchange="mudarTipoHorario(this.value, '{{ h }}')">

                    <option value="livre" {% if not tipo %}selected{% endif %}>
                        Livre
                    </option>

                    <option value="ocupado" {% if tipo == "ocupado" %}selected{% endif %}>
                        üîí Ocupado
                    </option>

                    <option value="dayuse" {% if tipo == "dayuse" %}selected{% endif %}>
                        Day Use
                    </option>

                    <option value="fechada" {% if tipo == "fechada" %}selected{% endif %}>
                        Arena Fechada
                    </option>

                    <option value="fixo" {% if tipo == "fixo" %}selected{% endif %}>
                        Hor√°rio Fixo
                    </option>

                </select>
            {% endif %}

        </div>
    {% endfor %}

    {% if session.get("tipo") == "dono" %}
        <a href="/datas/{{ esporte }}/{{ quadra }}" class="btn secundario">‚¨Ö Voltar</a>
    {% else %}
        <a href="/quadras/{{ esporte }}" class="btn secundario">‚¨Ö Voltar</a>
    {% endif %}
</div>

<!-- ================= MODAL RESERVA MANUAL ================= -->
<div id="modalReserva" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.6); z-index:9999;">
    <div style="background:#fff; max-width:400px; margin:10% auto; padding:20px; border-radius:10px;">
        <h3>Reserva Manual</h3>

        <input id="rm_nome" placeholder="Nome" style="width:100%; margin-bottom:10px;">
        <input id="rm_telefone" placeholder="Telefone" style="width:100%; margin-bottom:10px;">
        <input id="rm_email" placeholder="Email (opcional)" style="width:100%; margin-bottom:10px;">

        <label>
            <input type="checkbox" id="rm_pago"> Pago
        </label>

        <!-- ocultos -->
        <input type="hidden" id="rm_esporte" value="{{ esporte }}">
        <input type="hidden" id="rm_quadra" value="{{ quadra }}">
        <input type="hidden" id="rm_data" value="{{ data }}">
        <input type="hidden" id="rm_horario">

        <br><br>

        <button onclick="fecharModal()">Cancelar</button>
        <button onclick="salvarReservaManual()">Salvar</button>
    </div>
</div>

<script>
function mudarTipoHorario(tipo, horario) {

    // se for ocupado ‚Üí abre modal
    if (tipo === "ocupado") {
        document.getElementById("rm_horario").value = horario;
        document.getElementById("modalReserva").style.display = "block";
        return;
    }

    // outros tipos continuam como antes
    const form = document.createElement("form");
    form.method = "POST";
    form.action = "/admin/definir_horario";

    form.innerHTML = `
        <input type="hidden" name="data" value="{{ data }}">
        <input type="hidden" name="hora" value="${horario}">
        <input type="hidden" name="quadra" value="{{ quadra }}">
        <input type="hidden" name="tipo" value="${tipo}">
    `;

    document.body.appendChild(form);
    form.submit();
}

function fecharModal() {
    document.getElementById("modalReserva").style.display = "none";
}
</script>

</body>
</html>
