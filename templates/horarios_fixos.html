<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Hor√°rios Fixos</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="fundo-logo">

<div class="card grande card-fixos">
    <h1>‚è∞ Hor√°rios Fixos</h1>

    {% if fixos %}
    <table class="tabela-fixos">
        <thead>
            <tr>
                <th>Cliente</th>
                <th>Hora</th>
                <th>Quadra</th>
                <th>Dias do m√™s</th>
                <th>Cancelar</th>
            </tr>
        </thead>
        <tbody>
        {% for f in fixos %}
            <tr>
                <td class="fixo-cliente">
                    <strong>{{ f.cliente }}</strong>
                    <div class="fixo-contato">
                        {% if f.telefone %}<span>üìû {{ f.telefone }}</span>{% endif %}
                        {% if f.email %}<span>‚úâÔ∏è {{ f.email }}</span>{% else %}<span class="email-vazio">‚úâÔ∏è sem email</span>{% endif %}
                    </div>
                </td>
                <td>{{ f.hora }}</td>
                <td>{{ f.quadra }}</td>
                <td>
                    <div class="dias-mes">
                        {% for d in f.datas %}
                        <span
                            class="dia-bolinha {{ 'cancelado' if d.cancelado else '' }}"
                            title="Clique para cancelar ou reativar este dia"
                            data-quadra="{{ f.quadra }}"
                            data-hora="{{ f.hora }}"
                            data-data_iso="{{ d.data_iso }}"
                            data-cancelado="{{ 'true' if d.cancelado else 'false' }}"
                            onclick="executarToggle(this)">
                            {{ d.dia }}
                        </span>
                        {% endfor %}
                    </div>
                </td>
                <td>
                    <form method="POST" action="/admin/cancelar_fixo_definitivo" onsubmit="return confirm('Cancelar hor√°rio fixo definitivamente?');">
                        <input type="hidden" name="id_fixo" value="{{ f.id }}">
                        <button type="submit" class="btn-cancelar-fixo" title="Cancelar definitivamente">‚ùå</button>
                    </form>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p style="text-align:center;">Nenhum hor√°rio fixo cadastrado.</p>
    {% endif %}

    <a href="/painel_dono" class="btn-voltar">‚¨Ö Voltar</a>
</div>

<script>
function executarToggle(elemento) {
    // Captura os dados dos atributos data-
    const quadra = elemento.getAttribute('data-quadra');
    const hora = elemento.getAttribute('data-hora');
    const data = elemento.getAttribute('data-data_iso');
    const estaCancelado = elemento.getAttribute('data-cancelado') === 'true';

    const msg = estaCancelado
        ? "Deseja REATIVAR este hor√°rio fixo neste dia?"
        : "Deseja CANCELAR este hor√°rio fixo neste dia?";

    if (!confirm(msg)) return;

    fetch('/admin/toggle_fixo_dia', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            quadra: quadra,
            hora: hora,
            data: data,
            estaCancelado: estaCancelado
        })
    })
    .then(res => res.json())
    .then(resp => {
        if (resp.ok) {
            location.reload();
        } else {
            alert("Erro: " + resp.erro);
        }
    })
    .catch(err => {
        console.error(err);
        alert('Erro ao processar a requisi√ß√£o.');
    });
}
</script>
</body>
</html>