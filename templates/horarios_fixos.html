<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Hor√°rios Fixos</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body class="fundo-logo">

<div class="card grande card-fixos">
    <h1>‚è∞ Hor√°rios Fixos</h1>

    {% if fixos %}
    <table class="tabela-fixos">
        <thead>
            <tr>
                <th>Cliente</th>
                <th>Hora</th>
                <th>Quadra</th>
                <th>Dias do m√™s</th>
                <th>Cancelar</th>
            </tr>
        </thead>

        <tbody>
        {% for f in fixos %}
            <tr>

                <!-- CLIENTE -->
                <td class="fixo-cliente">
                    <strong>{{ f.cliente }}</strong>

                    <div class="fixo-contato">
                        {% if f.telefone %}
                            <span>üìû {{ f.telefone }}</span>
                        {% endif %}

                        {% if f.email %}
                            <span>‚úâÔ∏è {{ f.email }}</span>
                        {% else %}
                            <span class="email-vazio">‚úâÔ∏è sem email</span>
                        {% endif %}
                    </div>
                </td>

                <!-- HORA -->
                <td>{{ f.hora }}</td>

                <!-- QUADRA -->
                <td>{{ f.quadra }}</td>

                <!-- DIAS DO M√äS -->
                <td>
                    <div class="dias-mes">
                        {% for d in f.datas %}

                        {% set msg = 'Reativar este dia deste hor√°rio fixo?' if d.cancelado else 'Cancelar este dia deste hor√°rio fixo?' %}

                        <form method="POST"
                              action="/admin/toggle_fixo_dia"
                              style="display:inline;"
                              onsubmit="return abrirConfirmacao(this, '{{ msg }}');">

                            <input type="hidden" name="quadra" value="{{ f.quadra }}">
                            <input type="hidden" name="hora" value="{{ f.hora }}">
                            <input type="hidden" name="data" value="{{ d.data.strftime('%Y-%m-%d') }}">
                            <input type="hidden" name="cancelado" value="{{ 1 if d.cancelado else 0 }}">

                            <button type="submit"
                                    class="dia-bolinha{% if d.cancelado %} cancelado{% endif %}">
                                {{ d.data.strftime('%d') }}
                            </button>

                        </form>
                        {% endfor %}
                    </div>
                </td>

                <!-- CANCELAR DEFINITIVO -->
                 <td>
                 <form method="POST"
                  action="/admin/cancelar_fixo_definitivo"
                  onsubmit="return abrirConfirmacao(this, 'Cancelar este hor√°rio fixo DEFINITIVAMENTE? Esta a√ß√£o n√£o poder√° ser desfeita.');">

                 <input type="hidden" name="id_fixo" value="{{ f.id }}">

                 <button type="submit"
                 class="btn-cancelar-fixo"
                 title="Cancelar definitivamente">
                  ‚ùå
                 </button>
                 </form>
                 </td>


            </tr>
        {% endfor %}
        </tbody>
    </table>

    {% else %}
        <p style="text-align:center;">Nenhum hor√°rio fixo cadastrado.</p>
    {% endif %}

    <a href="/painel_dono" class="btn-voltar">‚¨Ö Voltar</a>
</div>

<!-- MODAL CONFIRMA√á√ÉO -->
<div id="modal-confirm" class="modal-overlay">
    <div class="modal-box">
        <h2>Confirmar a√ß√£o</h2>
        <p id="modal-msg"></p>

        <div class="modal-botoes">
            <button class="btn-confirmar" onclick="confirmarModal()">Confirmar</button>
            <button class="btn-cancelar" onclick="fecharModal()">Cancelar</button>
        </div>
    </div>
</div>

<!-- JS -->
<script>
let formParaEnviar = null;

function abrirConfirmacao(form, mensagem) {
    formParaEnviar = form;
    document.getElementById('modal-msg').innerText = mensagem;
    document.getElementById('modal-confirm').style.display = 'flex';
    return false;
}

function fecharModal() {
    document.getElementById('modal-confirm').style.display = 'none';
    formParaEnviar = null;
}

function confirmarModal() {
    if (formParaEnviar) {
        formParaEnviar.submit();
    }
}
</script>

</body>
</html>
