<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Hor√°rios Fixos</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body class="fundo-logo">

<div class="card grande card-fixos">
    <h1>‚è∞ Hor√°rios Fixos</h1>

    {% if fixos %}
    <table class="tabela-fixos">
        <thead>
            <tr>
                <th>Cliente</th>
                <th>Hora</th>
                <th>Quadra</th>
                <th>Dias do m√™s</th>
                <th>Cancelar</th>
            </tr>
        </thead>

        <tbody>
        {% for f in fixos %}
            <tr>

                <!-- CLIENTE -->
                <td class="fixo-cliente">
                    <strong>{{ f.cliente }}</strong>

                    <div class="fixo-contato">
                        {% if f.telefone %}
                            <span>üìû {{ f.telefone }}</span>
                        {% endif %}

                        {% if f.email %}
                            <span>‚úâÔ∏è {{ f.email }}</span>
                        {% else %}
                            <span class="email-vazio">‚úâÔ∏è sem email</span>
                        {% endif %}
                    </div>
                </td>

                <!-- HORA -->
                <td>{{ f.hora }}</td>

                <!-- QUADRA -->
                <td>{{ f.quadra }}</td>

                <!-- DIAS DO M√äS -->
                <td>
               <div class="dias-mes">
                {% for d in f.datas %}
                 <form method="POST"
              action="/admin/toggle_fixo_dia"
              style="display:inline;">

            <input type="hidden" name="quadra" value="{{ f.quadra }}">
            <input type="hidden" name="hora" value="{{ f.hora }}">
            <input type="hidden" name="data" value="{{ d.data_iso }}">
            <input type="hidden" name="cancelado" value="{{ 1 if d.cancelado else 0 }}">

            <button type="submit"
        class="dia-bolinha{% if d.cancelado %} cancelado{% endif %}"
        title="Clique para cancelar ou reativar este dia"
        {% if d.cancelado %}
            onclick="return confirm('Reativar este dia?')"
        {% else %}
            onclick="return confirm('Cancelar este dia?')"
        {% endif %}>
    {{ d.data.strftime('%d') }}
</button>


        </form>
        {% endfor %}
    </div>
</td>


                <!-- CANCELAR DEFINITIVO -->
                <td>
                    <form method="POST"
                          action="/admin/cancelar_fixo_definitivo"
                          onsubmit="return confirm('Cancelar hor√°rio fixo definitivamente?');">

                        <input type="hidden" name="id_fixo" value="{{ f.id }}">

                        <button type="submit"
                                class="btn-cancelar-fixo"
                                title="Cancelar definitivamente">
                            ‚ùå
                        </button>
                    </form>
                </td>

            </tr>
        {% endfor %}
        </tbody>
    </table>

    {% else %}
        <p style="text-align:center;">Nenhum hor√°rio fixo cadastrado.</p>
    {% endif %}

    <a href="/painel_dono" class="btn-voltar">‚¨Ö Voltar</a>
</div>

<!-- JS -->
<script>
function toggleCancelamento(quadra, hora, data, estaCancelado) {

    const msg = estaCancelado
        ? "Deseja REATIVAR este hor√°rio fixo neste dia?"
        : "Deseja CANCELAR este hor√°rio fixo neste dia?";

    if (!confirm(msg)) return;

    fetch('/admin/toggle_fixo_dia', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            quadra: quadra,
            hora: hora,
            data: data,
            cancelar: !estaCancelado   // üî• CASA COM O BACKEND
        })
    })
    .then(res => res.json())
    .then(r => {
        if (!r.ok) throw r.erro;
        location.reload();
    })
    .catch(() => alert('Erro ao cancelar/reativar o dia'));
}
</script>

</body>
</html>
